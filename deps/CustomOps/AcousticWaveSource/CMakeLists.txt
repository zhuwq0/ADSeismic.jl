find_program(_nvidia_smi "nvidia-smi")
if (_nvidia_smi)
  message("BUILD CUDA.....")
  find_package(CUDA QUIET REQUIRED)
  SET(CUDA_PROPAGATE_HOST_FLAGS ON)
  cuda_add_library(AcousticSource SHARED AcousticSource.cpp AcousticSource.cc AcousticSource.cu)
else()
  add_library(AcousticSource SHARED AcousticSource.cpp AcousticSource.cc)
  add_definitions(-DNOGPU)
endif()
set_property(TARGET AcousticSource PROPERTY POSITION_INDEPENDENT_CODE ON)
target_link_libraries(AcousticSource ${TF_LIB_FILE} "${TORCH_LIBRARIES}")

file(MAKE_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/build)
set_target_properties(AcousticSource PROPERTIES LIBRARY_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/build)
